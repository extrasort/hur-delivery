<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ุญุฑ - ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ | Hur Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.css' rel='stylesheet' />
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.15.0/mapbox-gl.js'></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
    <!-- Login Screen -->
    <div id="loginScreen" class="login-screen">
        <div class="login-container">
            <div class="login-header">
                <i class="fas fa-truck-fast"></i>
                <h1>ุญุฑ - ููุญุฉ ุงูุชุญูู ุงูุฅุฏุงุฑูุฉ</h1>
                <p>Hur Delivery Admin Panel</p>
            </div>
            <form id="loginForm" class="login-form" novalidate>
                <div class="form-group">
                    <label for="loginUsername">ุงุณู ุงููุณุชุฎุฏู / Username</label>
                    <input type="text" id="loginUsername" name="loginUsername" required placeholder="admin">
                </div>
                <div class="form-group">
                    <label for="loginPassword">ูููุฉ ุงููุฑูุฑ / Password</label>
                    <input type="password" id="loginPassword" name="loginPassword" required placeholder="โขโขโขโขโขโขโขโข">
                </div>
                <button type="submit" class="btn btn-primary" id="loginSubmitBtn">
                    <i class="fas fa-sign-in-alt"></i>
                    ุชุณุฌูู ุงูุฏุฎูู / Login
                </button>
                <div id="loginError" class="error-message"></div>
            </form>
        </div>
    </div>

    <!-- Main App -->
    <div id="appScreen" class="app-screen" style="display: none;">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <i class="fas fa-truck-fast"></i>
                <h2>ุญุฑ Admin</h2>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-item active" data-page="dashboard">
                    <i class="fas fa-home"></i>
                    <span>ููุญุฉ ุงูุชุญูู / Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-page="users">
                    <i class="fas fa-users"></i>
                    <span>ุงููุณุชุฎุฏููู / Users</span>
                </a>
                <a href="#" class="nav-item" data-page="orders">
                    <i class="fas fa-box"></i>
                    <span>ุงูุทูุจุงุช / Orders</span>
                </a>
                <a href="#" class="nav-item" data-page="drivers">
                    <i class="fas fa-motorcycle"></i>
                    <span>ุงูุณุงุฆููู / Drivers</span>
                </a>
                <a href="#" class="nav-item" data-page="merchants">
                    <i class="fas fa-store"></i>
                    <span>ุงูุชุฌุงุฑ / Merchants</span>
                </a>
                <a href="#" class="nav-item" data-page="wallets">
                    <i class="fas fa-wallet"></i>
                    <span>ุงููุญุงูุธ / Wallets</span>
                </a>
                <a href="#" class="nav-item" data-page="earnings">
                    <i class="fas fa-money-bill-wave"></i>
                    <span>ุงูุฃุฑุจุงุญ / Earnings</span>
                </a>
                <a href="#" class="nav-item" data-page="notifications">
                    <i class="fas fa-bell"></i>
                    <span>ุงูุฅุดุนุงุฑุงุช / Notifications</span>
                </a>
                <a href="#" class="nav-item" data-page="verification">
                    <i class="fas fa-user-check"></i>
                    <span>ุงูุชุญูู ูู ุงููุณุชุฎุฏููู / User Verification</span>
                </a>
                <a href="#" class="nav-item" data-page="tracking">
                    <i class="fas fa-map-marker-alt"></i>
                    <span>ุงูุชุชุจุน ุงููุจุงุดุฑ / Live Tracking</span>
                </a>
                <a href="#" class="nav-item" data-page="emergency" style="border-left: 3px solid #EF4444;">
                    <i class="fas fa-exclamation-triangle" style="color: #EF4444;"></i>
                    <span style="color: #EF4444; font-weight: 600;">ุงูุทูุงุฑุฆ / Emergency</span>
                </a>
                <a href="#" class="nav-item" data-page="sessions">
                    <i class="fas fa-mobile-alt"></i>
                    <span>ุงูุฌูุณุงุช / Device Sessions</span>
                </a>
                <a href="#" class="nav-item" data-page="financial">
                    <i class="fas fa-dollar-sign"></i>
                    <span>ุงููุงููุฉ / Financial</span>
                </a>
                <a href="#" class="nav-item" data-page="reviews">
                    <i class="fas fa-star"></i>
                    <span>ุงูุชููููุงุช / Reviews</span>
                </a>
                <a href="#" class="nav-item" data-page="promo-codes">
                    <i class="fas fa-ticket-alt"></i>
                    <span>ุฃููุงุฏ ุงูุฎุตู / Promo Codes</span>
                </a>
                <a href="#" class="nav-item" data-page="zones">
                    <i class="fas fa-map-marked-alt"></i>
                    <span>ุงูููุงุทู / Zones</span>
                </a>
                <a href="#" class="nav-item" data-page="blacklist">
                    <i class="fas fa-ban"></i>
                    <span>ุงููุงุฆูุฉ ุงูุณูุฏุงุก / Blacklist</span>
                </a>
                <a href="#" class="nav-item" data-page="messaging">
                    <i class="fas fa-comments"></i>
                    <span>ุฏุนู ุงูุนููุงุก / Support Messaging</span>
                </a>
                <a href="./ops_messaging.html" class="nav-item" target="_blank">
                    <i class="fas fa-headset"></i>
                    <span>ุบุฑูุฉ ุงูุฑุณุงุฆู / Ops Messaging</span>
                </a>
                <a href="#" class="nav-item" data-page="disputes">
                    <i class="fas fa-gavel"></i>
                    <span>ุงููุฒุงุนุงุช / Disputes</span>
                </a>
                <a href="#" class="nav-item" data-page="customers">
                    <i class="fas fa-user-friends"></i>
                    <span>ุงูุนููุงุก / Customers</span>
                </a>
                <a href="#" class="nav-item" data-page="announcements">
                    <i class="fas fa-bullhorn"></i>
                    <span>ุงูุฅุนูุงูุงุช / Announcements</span>
                </a>
                <a href="#" class="nav-item" data-page="performance">
                    <i class="fas fa-trophy"></i>
                    <span>ุงูุฃุฏุงุก / Performance</span>
                </a>
                <a href="#" class="nav-item" data-page="system-config">
                    <i class="fas fa-sliders-h"></i>
                    <span>ุฅุนุฏุงุฏุงุช ุงููุธุงู / System Config</span>
                </a>
                <a href="#" class="nav-item" data-page="analytics">
                    <i class="fas fa-chart-line"></i>
                    <span>ุงูุชุญูููุงุช / Analytics</span>
                </a>
                <a href="#" class="nav-item" data-page="settings">
                    <i class="fas fa-cog"></i>
                    <span>ุงูุฅุนุฏุงุฏุงุช / Settings</span>
                </a>
                <a href="#" class="nav-item" data-page="database">
                    <i class="fas fa-database"></i>
                    <span>ูุงุนุฏุฉ ุงูุจูุงูุงุช / Database</span>
                </a>
                <a href="#" class="nav-item" data-page="health" style="border-left: 3px solid #10B981;">
                    <i class="fas fa-heartbeat" style="color: #10B981;"></i>
                    <span style="color: #10B981; font-weight: 600;">Health Status / ุญุงูุฉ ุงูุตุญุฉ</span>
                </a>
            </nav>
            <div class="sidebar-footer">
                <button id="logoutBtn" class="btn btn-danger">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>ุชุณุฌูู ุงูุฎุฑูุฌ / Logout</span>
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button id="sidebarToggle" class="btn-icon">
                        <i class="fas fa-bars"></i>
                    </button>
                    <h1 id="pageTitle">ููุญุฉ ุงูุชุญูู / Dashboard</h1>
                </div>
                <div class="header-right">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="userName">Admin</span>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="content">
                <!-- Dashboard Page -->
                <div id="dashboardPage" class="page active">
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-icon blue">
                                <i class="fas fa-users"></i>
                            </div>
                            <div class="stat-details">
                                <h3 id="totalUsers">0</h3>
                                <p>ุฅุฌูุงูู ุงููุณุชุฎุฏููู<br>Total Users</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-box"></i>
                            </div>
                            <div class="stat-details">
                                <h3 id="totalOrders">0</h3>
                                <p>ุฅุฌูุงูู ุงูุทูุจุงุช<br>Total Orders</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon orange">
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="stat-details">
                                <h3 id="activeDrivers">0</h3>
                                <p>ุงูุณุงุฆููู ุงููุดุทูู<br>Active Drivers</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon purple">
                                <i class="fas fa-store"></i>
                            </div>
                            <div class="stat-details">
                                <h3 id="activeMerchants">0</h3>
                                <p>ุงูุชุฌุงุฑ ุงููุดุทูู<br>Active Merchants</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon teal">
                                <i class="fas fa-clock"></i>
                            </div>
                            <div class="stat-details">
                                <h3 id="pendingOrders">0</h3>
                                <p>ุงูุทูุจุงุช ุงููุนููุฉ<br>Pending Orders</p>
                            </div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-icon red">
                                <i class="fas fa-user-check"></i>
                            </div>
                            <div class="stat-details">
                                <h3 id="pendingVerifications">0</h3>
                                <p>ุชุญูู ูุนูู<br>Pending Verifications</p>
                            </div>
                        </div>
                    </div>

                    <div class="charts-grid">
                        <div class="chart-card">
                            <h3>ุฅุญุตุงุฆูุงุช ุงูุทูุจุงุช / Orders Statistics</h3>
                            <canvas id="ordersChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>ุชูุฒูุน ุงููุณุชุฎุฏููู / Users Distribution</h3>
                            <canvas id="usersChart"></canvas>
                        </div>
                    </div>

                    <div class="recent-section">
                        <h3>ุงูุทูุจุงุช ุงูุฃุฎูุฑุฉ / Recent Orders</h3>
                        <div id="recentOrders" class="table-container">
                            <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                        </div>
                    </div>
                </div>

                <!-- Users Page -->
                <div id="usersPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู / Users Management</h2>
                        <div class="page-actions">
                            <input type="text" id="usersSearch" class="search-input" placeholder="ุจุญุซ... / Search...">
                            <select id="usersRoleFilter" class="filter-select">
                                <option value="">ุฌููุน ุงูุฃุฏูุงุฑ / All Roles</option>
                                <option value="merchant">ุชุงุฌุฑ / Merchant</option>
                                <option value="driver">ุณุงุฆู / Driver</option>
                                <option value="customer">ุนููู / Customer</option>
                                <option value="admin">ูุฏูุฑ / Admin</option>
                            </select>
                            <button id="createAdminBtn" class="btn btn-success" onclick="openCreateAdminModal()">
                                <i class="fas fa-user-shield"></i> ุฅูุดุงุก ูุฏูุฑ / Create Admin
                            </button>
                            <button id="refreshUsers" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="usersTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Orders Page -->
                <div id="ordersPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุทูุจุงุช / Orders Management</h2>
                        <div class="page-actions">
                            <input type="text" id="ordersSearch" class="search-input" placeholder="ุจุญุซ... / Search...">
                            <select id="ordersStatusFilter" class="filter-select">
                                <option value="">ุฌููุน ุงูุญุงูุงุช / All Statuses</option>
                                <option value="pending">ูุนูู / Pending</option>
                                <option value="assigned">ูุฎุตุต / Assigned</option>
                                <option value="accepted">ููุจูู / Accepted</option>
                                <option value="on_the_way">ูู ุงูุทุฑูู / On The Way</option>
                                <option value="delivered">ุชู ุงูุชุณููู / Delivered</option>
                                <option value="cancelled">ููุบู / Cancelled</option>
                                <option value="rejected">ูุฑููุถ / Rejected</option>
                            </select>
                            <button id="refreshOrders" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="ordersTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Drivers Page -->
                <div id="driversPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุณุงุฆููู / Drivers Management</h2>
                        <div class="page-actions">
                            <input type="text" id="driversSearch" class="search-input" placeholder="ุจุญุซ... / Search...">
                            <select id="driversStatusFilter" class="filter-select">
                                <option value="">ุงููู / All</option>
                                <option value="online">ูุชุตู / Online</option>
                                <option value="offline">ุบูุฑ ูุชุตู / Offline</option>
                                <option value="verified">ููุซู / Verified</option>
                                <option value="unverified">ุบูุฑ ููุซู / Unverified</option>
                            </select>
                            <button id="refreshDrivers" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="driversTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Merchants Page -->
                <div id="merchantsPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุชุฌุงุฑ / Merchants Management</h2>
                        <div class="page-actions">
                            <input type="text" id="merchantsSearch" class="search-input" placeholder="ุจุญุซ... / Search...">
                            <select id="merchantsStatusFilter" class="filter-select">
                                <option value="">ุงููู / All</option>
                                <option value="verified">ููุซู / Verified</option>
                                <option value="unverified">ุบูุฑ ููุซู / Unverified</option>
                            </select>
                            <button id="refreshMerchants" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="merchantsTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Wallets Page -->
                <div id="walletsPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงููุญุงูุธ / Wallets Management</h2>
                        <div class="page-actions">
                            <input type="text" id="walletsSearch" class="search-input" placeholder="ุจุญุซ... / Search...">
                            <button id="refreshWallets" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="walletsTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Earnings Page -->
                <div id="earningsPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุฃุฑุจุงุญ / Earnings Management</h2>
                        <div class="page-actions">
                            <input type="text" id="earningsSearch" class="search-input" placeholder="ุจุญุซ... / Search...">
                            <select id="earningsStatusFilter" class="filter-select">
                                <option value="">ุฌููุน ุงูุญุงูุงุช / All Statuses</option>
                                <option value="pending">ูุนูู / Pending</option>
                                <option value="paid">ูุฏููุน / Paid</option>
                                <option value="cancelled">ููุบู / Cancelled</option>
                            </select>
                            <button id="refreshEarnings" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="earningsTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Notifications Page -->
                <div id="notificationsPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุฅุดุนุงุฑุงุช / Notifications Management</h2>
                        <div class="page-actions">
                            <button id="sendBulkNotification" class="btn btn-primary">
                                <i class="fas fa-paper-plane"></i> ุฅุฑุณุงู ุฅุดุนุงุฑ ุฌูุงุนู / Send Bulk
                            </button>
                            <button id="refreshNotifications" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="notificationsTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Verification Page -->
                <div id="verificationPage" class="page">
                    <div class="page-header">
                        <h2>ุงูุชุญูู ูู ุงููุณุชุฎุฏููู / User Verification</h2>
                        <div class="page-actions">
                            <select id="verificationRoleFilter" class="filter-select">
                                <option value="">ุฌููุน ุงูุฃุฏูุงุฑ / All Roles</option>
                                <option value="merchant">ุชุงุฌุฑ / Merchant</option>
                                <option value="driver">ุณุงุฆู / Driver</option>
                            </select>
                            <button id="refreshVerification" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="verificationTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Tracking Page -->
                <div id="trackingPage" class="page">
                    <div class="page-header">
                        <h2>ุงูุชุชุจุน ุงููุจุงุดุฑ / Live Tracking</h2>
                        <div class="page-actions">
                            <button id="refreshTracking" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                            <button id="centerMap" class="btn btn-info">
                                <i class="fas fa-crosshairs"></i> ุชูุณูุท ุงูุฎุฑูุทุฉ / Center Map
                            </button>
                        </div>
                    </div>
                    <div class="tracking-stats">
                        <div class="stat-card">
                            <div class="stat-icon green">
                                <i class="fas fa-motorcycle"></i>
                            </div>
                            <div class="stat-details">
                                <h3 id="onlineDriversCount">0</h3>
                                <p>ุณุงุฆููู ูุชุตููู<br>Online Drivers</p>
                            </div>
                        </div>
                    </div>
                    <div id="trackingMap" class="map-container">
                        <div id="map" style="width: 100%; height: 600px; border-radius: 0.75rem;"></div>
                    </div>
                    <div id="driversLocations" class="drivers-list-sidebar">
                        <h3>ุงูุณุงุฆููู ุงููุชุตููู / Online Drivers</h3>
                        <div id="driversListContent"></div>
                    </div>
                </div>

                <!-- Emergency Page -->
                <div id="emergencyPage" class="page">
                    <div class="page-header" style="background: linear-gradient(135deg, #FEE2E2 0%, #FECACA 100%); border-left: 4px solid #EF4444;">
                        <div>
                            <h2><i class="fas fa-exclamation-triangle" style="color: #EF4444;"></i> ูุฑุงูุจุฉ ุงูุทูุงุฑุฆ / Emergency Monitoring</h2>
                            <p style="color: #7F1D1D;">ูุฑุงูุจุฉ ุงูุทูุจุงุช ุงููุชุฃุฎุฑุฉ ูุงูุณุงุฆููู ุบูุฑ ุงููุดุทูู / Monitor delayed orders and inactive drivers</p>
                        </div>
                        <div>
                            <button class="btn btn-danger" id="systemShutdownBtn" onclick="toggleSystemShutdown()" style="margin-left: 10px;">
                                <i class="fas fa-power-off"></i> <span id="shutdownBtnText">ุฅููุงู ุงููุธุงู / Shutdown System</span>
                            </button>
                            <button class="btn btn-primary" id="refreshEmergency" onclick="loadEmergency()">
                                <i class="fas fa-sync-alt"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>

                    <!-- System Status Card -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-header" id="systemStatusHeader" style="background: #DCFCE7; color: #166534;">
                            <h3><i class="fas fa-circle" id="systemStatusIcon" style="color: #22C55E;"></i> <span id="systemStatusText">ุงููุธุงู ูุดุท / System Active</span></h3>
                        </div>
                        <div class="card-body">
                            <p id="systemStatusDescription">ุงููุธุงู ูุนูู ุจุดูู ุทุจูุนู. ุฌููุน ุงูููุฒุงุช ูุชุงุญุฉ. / System is operating normally. All features available.</p>
                            <div id="onlineDriversInfo"></div>
                        </div>
                    </div>

                    <!-- App Version Control Card -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-header" style="background: #DBEAFE; color: #1E3A8A;">
                            <h3><i class="fas fa-mobile-alt"></i> ุงูุชุญูู ุจุฅุตุฏุงุฑ ุงูุชุทุจูู / App Version Control</h3>
                        </div>
                        <div class="card-body">
                            <p style="margin-bottom: 15px;">ููููู ุฅุฌุจุงุฑ ุงููุณุชุฎุฏููู ุนูู ุชุญุฏูุซ ุงูุชุทุจูู ุนู ุทุฑูู ุชุนููู ุงูุญุฏ ุงูุฃุฏูู ููุฅุตุฏุงุฑ ุงููุทููุจ / Force users to update by setting minimum required version</p>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <div style="flex: 1;">
                                    <label for="minAppVersion" style="display: block; margin-bottom: 8px; font-weight: 600;">
                                        ุงูุญุฏ ุงูุฃุฏูู ููุฅุตุฏุงุฑ / Minimum Version:
                                    </label>
                                    <input 
                                        type="text" 
                                        id="minAppVersion" 
                                        placeholder="1.0.0" 
                                        style="width: 100%; padding: 10px; border: 1px solid #D1D5DB; border-radius: 8px; font-size: 16px;"
                                        pattern="\d+\.\d+\.\d+"
                                        title="Use semantic versioning (e.g., 1.0.0)"
                                    >
                                    <small style="color: #6B7280; display: block; margin-top: 5px;">
                                        Semantic versioning: major.minor.patch (e.g., 1.0.0, 2.3.1)
                                    </small>
                                </div>
                                <div>
                                    <button class="btn btn-primary" onclick="updateMinAppVersion()" style="margin-top: 25px;">
                                        <i class="fas fa-save"></i> ุญูุธ / Save
                                    </button>
                                </div>
                            </div>
                            <div id="versionUpdateStatus" style="margin-top: 15px;"></div>
                        </div>
                    </div>

                    <!-- Emergency Stats -->
                    <div class="stats-grid" style="margin-bottom: 20px;">
                        <div class="stat-card" style="background: linear-gradient(135deg, #FEE2E2 0%, #FCA5A5 100%); border-left: 4px solid #DC2626;">
                            <div class="stat-value" id="delayedOrdersCount">0</div>
                            <div class="stat-label">ุทูุจุงุช ูุชุฃุฎุฑุฉ / Delayed Orders</div>
                            <i class="fas fa-clock stat-icon" style="color: #DC2626;"></i>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #FED7AA 0%, #FDBA74 100%); border-left: 4px solid #EA580C;">
                            <div class="stat-value" id="inactiveDriversCount">0</div>
                            <div class="stat-label">ุณุงุฆููู ุบูุฑ ูุดุทูู / Inactive Drivers</div>
                            <i class="fas fa-motorcycle stat-icon" style="color: #EA580C;"></i>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border-left: 4px solid #D97706;">
                            <div class="stat-value" id="criticalIssuesCount">0</div>
                            <div class="stat-label">ูุถุงูุง ุญุฑุฌุฉ / Critical Issues</div>
                            <i class="fas fa-exclamation-circle stat-icon" style="color: #D97706;"></i>
                        </div>
                        <div class="stat-card" style="background: linear-gradient(135deg, #DBEAFE 0%, #93C5FD 100%); border-left: 4px solid #2563EB;">
                            <div class="stat-value" id="lastRefreshTime">--:--</div>
                            <div class="stat-label">ุขุฎุฑ ุชุญุฏูุซ / Last Refresh</div>
                            <i class="fas fa-sync stat-icon" style="color: #2563EB;"></i>
                        </div>
                    </div>

                    <!-- Delayed Orders Section -->
                    <div class="content-card" style="margin-bottom: 20px;">
                        <div class="card-header" style="background: #FEE2E2; color: #991B1B;">
                            <h3><i class="fas fa-clock"></i> ุทูุจุงุช ูุชุฃุฎุฑุฉ (ุฃูุซุฑ ูู ุณุงุนุฉ) / Delayed Orders (Over 1 Hour)</h3>
                        </div>
                        <div class="card-body">
                            <div id="delayedOrdersTable">
                                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Inactive Drivers Section -->
                    <div class="content-card">
                        <div class="card-header" style="background: #FFEDD5; color: #9A3412;">
                            <h3><i class="fas fa-motorcycle"></i> ุณุงุฆููู ุบูุฑ ูุดุทูู ูุน ุทูุจุงุช ูุดุทุฉ / Inactive Drivers with Active Orders</h3>
                            <small>ุงููููุน ูู ูุชู ุชุญุฏูุซู ููุฐ ุฃูุซุฑ ูู 5 ุฏูุงุฆู / Location not updated for over 5 minutes</small>
                        </div>
                        <div class="card-body">
                            <div id="inactiveDriversTable">
                                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Sessions Page -->
                <div id="sessionsPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุฌูุณุงุช / Device Sessions Management</h2>
                        <div class="page-actions">
                            <input type="text" id="sessionsSearch" class="search-input" placeholder="ุจุญุซ... / Search...">
                            <button id="refreshSessions" class="btn btn-secondary">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="sessionsTable" class="table-container">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                    </div>
                </div>

                <!-- Analytics Page -->
                <div id="analyticsPage" class="page">
                    <h2>ุงูุชุญูููุงุช ุงููุชูุฏูุฉ / Advanced Analytics</h2>
                    <div class="analytics-grid">
                        <div class="chart-card">
                            <h3>ุงูุทูุจุงุช ุญุณุจ ุงูุชุงุฑูุฎ / Orders by Date</h3>
                            <canvas id="ordersDateChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>ุงูุฅูุฑุงุฏุงุช / Revenue</h3>
                            <canvas id="revenueChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>ุฃุฏุงุก ุงูุณุงุฆููู / Driver Performance</h3>
                            <canvas id="driverPerformanceChart"></canvas>
                        </div>
                        <div class="chart-card">
                            <h3>ุฃุฏุงุก ุงูุชุฌุงุฑ / Merchant Performance</h3>
                            <canvas id="merchantPerformanceChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Settings Page -->
                <div id="settingsPage" class="page">
                    <h2>ุฅุนุฏุงุฏุงุช ุงููุธุงู / System Settings</h2>
                    <div class="settings-container">
                        <div class="settings-card">
                            <h3>ุฅุนุฏุงุฏุงุช ุนุงูุฉ / General Settings</h3>
                            <div id="settingsForm" class="form-grid">
                                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Financial Dashboard Page -->
                <div id="financialPage" class="page">
                    <div class="page-header">
                        <h2>ููุญุฉ ุงููุงููุฉ / Financial Dashboard</h2>
                    </div>
                    <div id="financialSummary" class="cards-grid"></div>
                    <div class="card">
                        <h3>ุงูุชูุฑูุฑ ุงููููู / Daily Revenue Report</h3>
                        <div id="dailyRevenueTable"></div>
                    </div>
                </div>

                <!-- Reviews & Ratings Page -->
                <div id="reviewsPage" class="page">
                    <div class="page-header">
                        <h2>ุงูุชููููุงุช ูุงููุฑุงุฌุนุงุช / Reviews & Ratings</h2>
                        <a href="./ops_messaging.html" class="btn btn-primary" target="_blank"><i class="fas fa-headset"></i> ุบุฑูุฉ ุนูููุงุช ุงูุฑุณุงุฆู</a>
                    </div>
                    <div id="reviewsContent"></div>
                </div>

                <!-- Promo Codes Page -->
                <div id="promo-codesPage" class="page">
                    <div class="page-header">
                        <h2>ุฃููุงุฏ ุงูุฎุตู / Promotional Codes</h2>
                        <button class="btn btn-primary" onclick="openCreatePromoModal()">
                            <i class="fas fa-plus"></i> ุฅูุดุงุก ููุฏ ุฌุฏูุฏ / Create Code
                        </button>
                    </div>
                    <div id="promoCodesTable"></div>
                </div>

                <!-- Delivery Zones Page -->
                <div id="zonesPage" class="page">
                    <div class="page-header">
                        <h2>ููุงุทู ุงูุชูุตูู / Delivery Zones</h2>
                        <button class="btn btn-primary" onclick="openCreateZoneModal()">
                            <i class="fas fa-plus"></i> ุฅูุดุงุก ููุทูุฉ / Create Zone
                        </button>
                    </div>
                    <div id="zonesTable"></div>
                </div>

                <!-- Blacklist Page -->
                <div id="blacklistPage" class="page">
                    <div class="page-header">
                        <h2>ุงููุงุฆูุฉ ุงูุณูุฏุงุก / Blacklist</h2>
                        <button class="btn btn-primary" onclick="openAddBlacklistModal()">
                            <i class="fas fa-plus"></i> ุฅุถุงูุฉ ูููุงุฆูุฉ ุงูุณูุฏุงุก / Add to Blacklist
                        </button>
                    </div>
                    <div id="blacklistTable"></div>
                </div>

                <!-- Messaging Page -->
                <div id="messagingPage" class="page">
                    <div class="messaging-container">
                        <div class="messaging-conversations">
                            <div class="messaging-header">
                                <div class="messaging-header-top">
                                    <div class="messaging-header-title">
                                <i class="fas fa-comments"></i>
                                <h2>ุฏุนู ุงูุนููุงุก / Support Messaging</h2>
                                    </div>
                                    <button id="messagingNewConversationBtn" class="btn btn-primary">
                                        <i class="fas fa-plus"></i> ูุญุงุฏุซุฉ ุฌุฏูุฏุฉ / New Chat
                                    </button>
                                </div>
                                <div class="messaging-header-actions">
                                    <input type="search" id="messagingSearch" placeholder="๐ ุงูุจุญุซ ูู ุงููุญุงุฏุซุงุช..." />
                                    <select id="messagingRoleFilter">
                                        <option value="all">ูู ุงููุญุงุฏุซุงุช</option>
                                        <option value="driver">ุงูุณุงุฆููู</option>
                                        <option value="merchant">ุงูุชุฌุงุฑ</option>
                                        <option value="customer">ุงูุนููุงุก</option>
                                    </select>
                                </div>
                            </div>
                            <div id="messagingConversations" class="messaging-list">
                                <p class="empty-state">ูุง ุชูุฌุฏ ูุญุงุฏุซุงุช ุญุงููุงู / No conversations yet</p>
                            </div>
                        </div>
                        <div class="messaging-thread">
                            <div class="messaging-thread-header">
                                <div>
                                    <h3 id="messagingActiveTitle">ุงุฎุชุฑ ูุญุงุฏุซุฉ / Select a conversation</h3>
                                    <p id="messagingActiveSubtitle" class="thread-subtitle"></p>
                                </div>
                                <button id="messagingRefreshBtn" class="btn btn-secondary btn-small">
                                    <i class="fas fa-rotate-right"></i> ุชุญุฏูุซ / Refresh
                                </button>
                            </div>
                            <div id="messagingMessages" class="messaging-messages">
                                <div class="empty-state">ุงุฎุชุฑ ูุญุงุฏุซุฉ ูุนุฑุถ ุงูุฑุณุงุฆู / Select a conversation to view messages</div>
                            </div>
                            <div id="messagingOrders" class="messaging-orders-panel">
                                <div class="panel-header">
                                    <h4>ุทูุจุงุช ุงููุณุชุฎุฏู / User Orders</h4>
                                </div>
                                <div class="panel-content">
                                    <div class="empty-state">ูุง ุชูุฌุฏ ุทูุจุงุช / No orders</div>
                                </div>
                            </div>
                            <div class="messaging-compose">
                                <div id="messagingReplyPreview" class="messaging-reply-preview hidden">
                                    <div>
                                        <strong id="messagingReplyAuthor"></strong>
                                        <p id="messagingReplySnippet"></p>
                                    </div>
                                    <button type="button" id="messagingReplyCancel" class="btn-icon" title="ุฅูุบุงุก ุงูุฑุฏ">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                                <textarea id="messagingCompose" rows="2" placeholder="ุงูุชุจ ุฑุฏ ุงูุฏุนู... / Write a support reply..."></textarea>
                                <div class="compose-actions">
                                <button id="messagingSendBtn" class="btn btn-primary">
                                    <i class="fas fa-paper-plane"></i> ุฅุฑุณุงู / Send
                                </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Disputes Page -->
                <div id="disputesPage" class="page">
                    <div class="page-header">
                        <h2>ุงููุฒุงุนุงุช / Disputes</h2>
                    </div>
                    <div id="disputesTable"></div>
                </div>

                <!-- Customers Page -->
                <div id="customersPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุฏุงุฑุฉ ุงูุนููุงุก / Customer Management</h2>
                        <input type="search" id="customerSearch" placeholder="๐ ุงูุจุญุซ ุจุฑูู ุงููุงุชู / Search by phone">
                    </div>
                    <div id="customersTable"></div>
                </div>

                <!-- Announcements Page -->
                <div id="announcementsPage" class="page">
                    <div class="page-header">
                        <h2>ุงูุฅุนูุงูุงุช / Announcements</h2>
                        <button class="btn btn-primary" onclick="openCreateAnnouncementModal()">
                            <i class="fas fa-plus"></i> ุฅูุดุงุก ุฅุนูุงู / Create Announcement
                        </button>
                    </div>
                    <div id="announcementsTable"></div>
                </div>

                <!-- Performance Page -->
                <div id="performancePage" class="page">
                    <div class="page-header">
                        <h2>ุฃุฏุงุก ุงูุณุงุฆููู / Driver Performance</h2>
                    </div>
                    <div id="topDriversTable"></div>
                    <div class="card">
                        <h3>ุชูุงุตูู ุณุงุฆู / Driver Details</h3>
                        <div id="driverPerformanceDetails"></div>
                    </div>
                </div>

                <!-- System Config Page -->
                <div id="system-configPage" class="page">
                    <div class="page-header">
                        <h2>ุฅุนุฏุงุฏุงุช ุงููุธุงู / System Configuration</h2>
                    </div>
                    <div id="systemConfigTable"></div>
                </div>

                <!-- Database Page -->
                <div id="databasePage" class="page">
                    <h2>ุฅุฏุงุฑุฉ ูุงุนุฏุฉ ุงูุจูุงูุงุช / Database Management</h2>
                    <div class="database-tools" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                        
                        <div class="card">
                            <h3>๐ฅ ุชุตุฏูุฑ ุงูุจูุงูุงุช / Data Export</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button class="btn btn-primary" onclick="exportOrdersToCSV()">
                                    <i class="fas fa-download"></i> ุชุตุฏูุฑ ุงูุทูุจุงุช / Export Orders
                                </button>
                                <button class="btn btn-primary" onclick="exportTransactionsToCSV()">
                                    <i class="fas fa-download"></i> ุชุตุฏูุฑ ุงููุนุงููุงุช / Export Transactions
                                </button>
                                <button class="btn btn-primary" onclick="exportUsersToCSV()">
                                    <i class="fas fa-download"></i> ุชุตุฏูุฑ ุงููุณุชุฎุฏููู / Export Users
                                </button>
                                <button class="btn btn-success" onclick="generateComprehensiveReport()">
                                    <i class="fas fa-file-pdf"></i> ุชูุฑูุฑ ุดุงูู / Comprehensive Report
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3>๐ ุชุตุฏูุฑ ุญุณุจ ุงููุฆุฉ / Export by Category</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button class="btn btn-info" onclick="exportUsersToCSV('driver')">
                                    <i class="fas fa-motorcycle"></i> ุงูุณุงุฆููู / Drivers
                                </button>
                                <button class="btn btn-info" onclick="exportUsersToCSV('merchant')">
                                    <i class="fas fa-store"></i> ุงูุชุฌุงุฑ / Merchants
                                </button>
                                <button class="btn btn-info" onclick="exportUsersToCSV(null)">
                                    <i class="fas fa-users"></i> ุงูุนููุงุก / Customers
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <h3>๐ง ุฃุฏูุงุช ูุชูุฏูุฉ / Advanced Tools</h3>
                            <div style="display: flex; flex-direction: column; gap: 10px;">
                                <button class="btn btn-warning" onclick="openDateRangeExport()">
                                    <i class="fas fa-calendar-alt"></i> ุชุตุฏูุฑ ุจุชุงุฑูุฎ ูุญุฏุฏ / Date Range Export
                                </button>
                                <button class="btn btn-info" onclick="loadDatabaseStats()">
                                    <i class="fas fa-chart-bar"></i> ุฅุญุตุงุฆูุงุช DB / DB Stats
                                </button>
                            </div>
                        </div>
                        
                    </div>
                    
                    <div class="card" style="margin-top: 20px;">
                        <h3>๐ ุฅุญุตุงุฆูุงุช ูุงุนุฏุฉ ุงูุจูุงูุงุช / Database Statistics</h3>
                        <div id="databaseStatsContent"></div>
                    </div>
                    
                    <div class="tool-card" style="display: none;">
                        <h3>SQL Query Runner</h3>
                        <textarea id="sqlQuery" placeholder="SELECT * FROM users LIMIT 10;" rows="5"></textarea>
                        <button class="btn btn-primary" onclick="admin.runSQLQuery()">
                            <i class="fas fa-play"></i> ุชูููุฐ / Execute
                        </button>
                            <div id="sqlResults"></div>
                        </div>
                    </div>
                </div>

                <!-- Health Status Page -->
                <div id="healthPage" class="page">
                    <div class="page-header">
                        <h2>
                            <i class="fas fa-heartbeat" style="color: #10B981;"></i> 
                            Health Status / ุญุงูุฉ ุงูุตุญุฉ
                        </h2>
                        <div class="page-actions">
                            <button id="refreshHealth" class="btn btn-secondary" onclick="loadHealthStatus()">
                                <i class="fas fa-sync"></i> ุชุญุฏูุซ / Refresh
                            </button>
                        </div>
                    </div>
                    <div id="healthPageContent">
                        <p class="loading">ุฌุงุฑู ุงูุชุญููู... / Loading...</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- User Details Modal -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ุชูุงุตูู ุงููุณุชุฎุฏู / User Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="userModalBody">
                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
            </div>
        </div>
    </div>

    <!-- Order Details Modal -->
    <div id="orderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ุชูุงุตูู ุงูุทูุจ / Order Details</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="orderModalBody">
                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
            </div>
        </div>
    </div>

    <!-- Wallet Top-up Modal -->
    <div id="walletModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ุดุญู ุงููุญูุธุฉ / Top-up Wallet</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="walletModalBody">
                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
            </div>
        </div>
    </div>

    <!-- Notification Send Modal -->
    <div id="notificationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ุฅุฑุณุงู ุฅุดุนุงุฑ / Send Notification</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="notificationForm">
                    <div class="form-group">
                        <label>ุงููุณุชูู / Recipient</label>
                        <select id="notifRecipient" required>
                            <option value="all">ุงูุฌููุน / All</option>
                            <option value="merchants">ุงูุชุฌุงุฑ / Merchants</option>
                            <option value="drivers">ุงูุณุงุฆููู / Drivers</option>
                            <option value="customers">ุงูุนููุงุก / Customers</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>ุงูุนููุงู / Title</label>
                        <input type="text" id="notifTitle" required>
                    </div>
                    <div class="form-group">
                        <label>ุงูุฑุณุงูุฉ / Message</label>
                        <textarea id="notifBody" required rows="4"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-paper-plane"></i> ุฅุฑุณุงู / Send
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- User Verification Modal -->
    <div id="verificationModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ุงูุชุญูู ูู ุงููุณุชุฎุฏู / User Verification</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="verificationModalBody">
                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
            </div>
        </div>
    </div>

    <!-- Order Action Modal -->
    <div id="orderActionModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>ุฅุฏุงุฑุฉ ุงูุทูุจ / Order Management</h2>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body" id="orderActionModalBody">
                <p class="loading">ุฌุงุฑู ุงูุชุญููู...</p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="config.js"></script>
    <script src="app_messaging.js"></script>
    <script src="app.js"></script>
    <script src="app_verification.js"></script>
    <script src="app_order_management.js"></script>
    <script src="app_admin_management.js"></script>
    <script src="app_emergency.js"></script>
    <script src="app_features.js"></script>
    <script src="app_reports.js"></script>
    <script src="app_health.js"></script>
    <div id="messagingNewConversationModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>ูุญุงุฏุซุฉ ุฏุนู ุฌุฏูุฏุฉ / Start Support Conversation</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="messagingNewConversationForm" class="form-grid">
                    <div class="form-group full-width">
                        <label for="messagingUserSearch">ุงุจุญุซ ุนู ูุณุชุฎุฏู / Search User</label>
                        <input type="search" id="messagingUserSearch" placeholder="ุงูุงุณูุ ุงููุงุชู ุฃู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู" autocomplete="off" />
                        <div id="messagingUserResults" class="messaging-user-results"></div>
                    </div>
                    <div class="form-group">
                        <label for="messagingOrderInput">ูุนุฑู ุงูุทูุจ (ุงุฎุชูุงุฑู) / Order ID (optional)</label>
                        <input type="text" id="messagingOrderInput" placeholder="UUID ุฃู ุฑูู ุงูุทูุจ" />
                    </div>
                    <div class="form-group">
                        <label for="messagingInitialMessage">ุฑุณุงูุฉ ุชุฑุญูุจูุฉ (ุงุฎุชูุงุฑู) / Initial Message (optional)</label>
                        <textarea id="messagingInitialMessage" rows="3" placeholder="ุงูุชุจ ุฑุณุงูุฉ ุชุฑุญูุจูุฉ ูุชุจุฏุฃ ุงููุญุงุฏุซุฉ..."></textarea>
                    </div>
                    <div class="modal-actions">
                        <button type="button" class="btn btn-secondary" id="messagingNewConversationCancel">ุฅูุบุงุก / Cancel</button>
                        <button type="submit" class="btn btn-primary">ุจุฏุก ุงููุญุงุฏุซุฉ / Start Chat</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</body>
</html>
